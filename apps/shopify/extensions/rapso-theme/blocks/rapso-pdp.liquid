{% comment %}
Rapso PDP block — renders a small button and modal for uploading a photo and height.
{% endcomment %}

{{ 'rapso-pdp.css' | asset_url | stylesheet_tag }}
<script defer src="{{ 'rapso-pdp.js' | asset_url }}"></script>

<div class="rapso-block" data-rapso-block data-shop="{{ shop.permanent_domain }}" data-small-max="{{ block.settings.small_max_cm }}" data-medium-max="{{ block.settings.medium_max_cm }}" data-sizes-labels="{{ block.settings.sizes_labels | escape }}">
  <button class="rapso-btn" type="button">{{ block.settings.button_label | default: 'rapso.pdp.button' | t | escape }}</button>
  <div class="rapso-modal" hidden role="dialog" aria-modal="true" aria-labelledby="rapso-title-{{ block.id }}">
    <div class="rapso-modal__dialog">
      <div class="rapso-modal__header">
        <div class="rapso-title" id="rapso-title-{{ block.id }}">{{ 'rapso.pdp.title' | t }}</div>
        <button class="rapso-close" type="button" aria-label="Close">×</button>
      </div>
      <div class="rapso-modal__body">
        <div class="rapso-field">
          <label for="rapso-file-{{ block.id }}">{{ 'rapso.pdp.photo_label' | t }}</label>
          <input id="rapso-file-{{ block.id }}" type="file" accept="image/*" />
        </div>
        <div class="rapso-field">
          <label for="rapso-units-{{ block.id }}">{{ 'rapso.pdp.units_label' | t }}</label>
          <select id="rapso-units-{{ block.id }}" class="rapso-units">
            <option value="cm">cm</option>
            <option value="in">in</option>
          </select>
        </div>
        <div class="rapso-field">
          <label for="rapso-height-{{ block.id }}">{{ 'rapso.pdp.height_label' | t }} (cm)</label>
          <input id="rapso-height-{{ block.id }}" type="number" min="100" max="250" step="1" placeholder="170" />
        </div>
        <div class="rapso-actions">
          <button class="rapso-submit" type="button">Upload</button>
        </div>
        <div class="rapso-status" aria-live="polite"></div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Rapso Try-on",
  "target": "section",
  "settings": [
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Try on with Rapso" },
    { "type": "range", "id": "small_max_cm", "label": "Small max height (cm)", "min": 120, "max": 190, "step": 1, "default": 165 },
    { "type": "range", "id": "medium_max_cm", "label": "Medium max height (cm)", "min": 130, "max": 210, "step": 1, "default": 180 },
    { "type": "text", "id": "sizes_labels", "label": "Sizes labels (comma‑separated)", "default": "S,M,L" }
  ]
}
{% endschema %}
